<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produits - Ma Boutique √âl√©gante</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="oda.jpg">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="produits-styles.css">
</head>
<style>
    :root {
    --primary-color: #007AFF;
    --primary-hover: #0056b3;
    --secondary-color: #E8F4FF;
    --accent-color: #34C759;
    --bg-general: #F5F5F7;
    --bg-card: #FFFFFF;
    --text-primary: #1D1D1F;
    --text-secondary: #86868B;
    --border-color: #D2D2D7;
    --success: #34C759;
    --warning: #FF9500;
    --error: #FF3B30;
    --gradient-primary: linear-gradient(135deg, #007AFF 0%, #5AC8FA 100%);
    --gradient-soft: linear-gradient(135deg, #E8F4FF 0%, #F5F5F7 100%);
    --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.08);
    --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.12);
    --shadow-heavy: 0 8px 24px rgba(0, 0, 0, 0.16);
    --spacing-xs: 8px;
    --spacing-sm: 12px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 20px;
    --transition-fast: 0.3s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--bg-general);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
    min-height: 100vh;
}

/* ==================== ANIMATIONS ==================== */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeOut {
    to { opacity: 0; transform: translateY(-10px); }
}

/* ==================== HEADER ==================== */
.main-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow-light);
    z-index: 1000;
    animation: slideDown var(--transition-fast);
}

.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md) var(--spacing-lg);
    max-width: 1920px;
    margin: 0 auto;
}

.brand-section {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.logo-image {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.brand-name {
    font-size: 1.4rem;
    font-weight: 600;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.header-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.icon-btn {
    position: relative;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 8px;
}

.notification-btn .badge {
    position: absolute;
    top: 5px;
    right: 5px;
    background: #FF3B30;
    color: white;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: 600;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-xl);
    background: var(--gradient-soft);
    cursor: pointer;
}

.avatar-image {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    background: var(--gradient-primary);
    border: 2px solid var(--primary-color);
}

.user-name {
    font-weight: 500;
    color: var(--text-primary);
}

/* ==================== SIDEBAR GAUCHE (VERSION PC) ==================== */
.sidebar-left {
    position: fixed;
    left: 0;
    top: 80px;
    width: 280px;
    height: calc(100vh - 80px);
    background: var(--bg-card);
    box-shadow: var(--shadow-light);
    padding: var(--spacing-lg);
    overflow-y: auto;
    z-index: 100;
}

.action-section {
    margin-bottom: var(--spacing-xl);
}

.btn-new-product {
    width: 100%;
    padding: var(--spacing-md);
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
}

.btn-new-product:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-heavy);
}

.kpi-section {
    margin-bottom: var(--spacing-lg);
}

.sidebar-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
}

.kpi-card {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--gradient-soft);
    border-radius: var(--radius-md);
    margin-bottom: var(--spacing-sm);
    transition: var(--transition-fast);
}

.kpi-card:hover {
    transform: translateX(5px);
    box-shadow: var(--shadow-light);
}

.kpi-icon {
    font-size: 2rem;
}

.kpi-content {
    flex: 1;
}

.kpi-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 4px;
}

.kpi-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary-color);
}

/* Navigation sidebar */
.sidebar-nav {
    margin-top: var(--spacing-lg);
}

.nav-link {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 500;
    border-radius: var(--radius-md);
    transition: var(--transition-fast);
    margin-bottom: var(--spacing-xs);
}

.nav-link:hover {
    background: var(--gradient-soft);
    color: var(--primary-color);
    transform: translateX(5px);
}

.nav-link.active {
    background: var(--gradient-primary);
    color: white;
}

.nav-icon {
    font-size: 1.3rem;
}

.nav-divider {
    height: 2px;
    background: var(--secondary-color);
    margin: var(--spacing-md) 0;
}

/* Ajuster le contenu principal pour la sidebar */
.products-container {
    margin-left: 280px;
    transition: margin-left var(--transition-fast);
}


/* ==================== BOUTON HAMBURGER - CORRIG√â ==================== */
.hamburger-btn {
    display: flex !important;
    flex-direction: column;
    justify-content: space-around;
    width: 32px;
    height: 32px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 4px;
    z-index: 10001;
    transition: all 0.3s ease;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    position: relative;
}

.hamburger-btn span {
    display: block;
    width: 100%;
    height: 3px;
    background: var(--primary-color);
    border-radius: 3px;
    transition: all 0.3s ease;
}

.hamburger-btn:hover span {
    background: var(--primary-hover);
}

.hamburger-btn.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
}

.hamburger-btn.active span:nth-child(2) {
    opacity: 0;
}

.hamburger-btn.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
}

/* ==================== OVERLAY ==================== */
.hamburger-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: 9998;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    pointer-events: none;
}

.hamburger-overlay.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
}

/* ==================== MENU HAMBURGER ==================== */
.hamburger-menu {
    position: fixed;
    top: 0;
    left: -100%;
    width: 320px;
    height: 100vh;
    height: 100dvh;
    background: white;
    box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.hamburger-menu.active {
    left: 0;
}

/* ==================== HEADER DU MENU ==================== */
.hamburger-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid #f0f0f0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    flex-shrink: 0;
}

.hamburger-header .brand-section {
    display: flex;
    align-items: center;
    gap: 12px;
}

.hamburger-header .logo-image {
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.hamburger-header .brand-name {
    font-size: 1.3rem;
    font-weight: 700;
    color: white;
    -webkit-text-fill-color: white;
}

/* ==================== BOUTON FERMER ==================== */
.close-menu {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    line-height: 1;
    flex-shrink: 0;
}

.close-menu:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

/* ==================== NAVIGATION ==================== */
.hamburger-nav {
    flex: 1;
    padding: 20px 0;
    overflow-y: auto;
}

.hamburger-link {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 14px 20px;
    color: #333;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    border: none;
    background: transparent;
    width: 100%;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    text-align: left;
}

.hamburger-link:hover {
    background: #f8f9fa;
    color: var(--primary-color);
    padding-left: 25px;
}

.hamburger-link.active {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
    color: var(--primary-color);
    border-left: 4px solid var(--primary-color);
    font-weight: 600;
}

.link-icon {
    font-size: 1.3rem;
    min-width: 24px;
    text-align: center;
}

/* ==================== S√âPARATEUR ==================== */
.hamburger-divider {
    height: 1px;
    background: #e0e0e0;
    margin: 15px 20px;
}

/* ==================== FOOTER DU MENU ==================== */
.hamburger-footer {
    padding: 15px 20px;
    border-top: 1px solid #f0f0f0;
    background: #fafafa;
    flex-shrink: 0;
}

.hamburger-footer .hamburger-link {
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

/* ==================== SCROLLBAR ==================== */
.hamburger-menu::-webkit-scrollbar,
.hamburger-nav::-webkit-scrollbar {
    width: 6px;
}

.hamburger-menu::-webkit-scrollbar-track,
.hamburger-nav::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.hamburger-menu::-webkit-scrollbar-thumb,
.hamburger-nav::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 3px;
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .hamburger-menu {
        width: 85%;
        max-width: 320px;
    }
    
    .hamburger-btn {
        width: 28px;
        height: 28px;
    }
    
    .hamburger-link {
        padding: 16px 20px;
        min-height: 48px;
    }
}

@media (max-width: 480px) {
    .hamburger-menu {
        width: 90%;
    }
}

/* ==================== BLOCAGE SCROLL ==================== */
body.menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100vh;
}
/* ==================== CONTENU PRINCIPAL ==================== */
.products-container {
    max-width: 1920px;
    margin: 0 auto;
    padding: calc(80px + var(--spacing-lg)) var(--spacing-lg) var(--spacing-lg);
}

.page-header {
    margin-bottom: var(--spacing-xl);
    text-align: center;
}

.page-title {
    font-size: 2.5rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: var(--spacing-sm);
    animation: fadeIn 0.6s ease;
}

.page-subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
    animation: fadeIn 0.8s ease;
}

/* ==================== FILTRES ==================== */
.filters-section {
    background: var(--bg-card);
    padding: var(--spacing-lg);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-light);
    margin-bottom: var(--spacing-xl);
    animation: fadeIn 1s ease;
}

.search-bar {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    flex-wrap: wrap;
}

.search-input {
    flex: 1;
    min-width: 250px;
    padding: var(--spacing-md);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    transition: var(--transition-fast);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15);
}

.filter-select {
    padding: var(--spacing-md);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    background: var(--bg-card);
    cursor: pointer;
    transition: var(--transition-fast);
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary-color);
}

.stats-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--border-color);
}

.products-count {
    font-weight: 600;
    color: var(--primary-color);
}

.action-buttons {
    display: flex;
    gap: var(--spacing-sm);
}

.btn-action {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 2px solid var(--primary-color);
    background: var(--bg-card);
    color: var(--primary-color);
    border-radius: var(--radius-md);
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    white-space: nowrap;
}

.btn-action:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-2px);
}

/* ==================== GRILLE PRODUITS ==================== */
.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
}

.product-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-light);
    transition: var(--transition-fast);
    animation: fadeIn 0.6s ease;
    animation-fill-mode: both;
    cursor: pointer;
    border: 1px solid var(--border-color);
}

.product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-medium);
}

.product-image-container {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
    background: var(--gradient-soft);
}

.product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

.product-badges {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.badge {
    padding: 4px 10px;
    border-radius: 16px;
    font-size: 0.7rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
}

.badge-published {
    background: rgba(52, 199, 89, 0.9);
    color: white;
}

.badge-draft {
    background: rgba(255, 149, 0, 0.9);
    color: white;
}

.badge-category {
    background: rgba(255, 255, 255, 0.95);
    color: var(--primary-color);
}

.product-content {
    padding: var(--spacing-md);
}

.product-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.product-description {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: var(--spacing-sm);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.4;
}

.product-images-preview {
    display: flex;
    gap: 4px;
    margin-bottom: var(--spacing-sm);
    flex-wrap: wrap;
}

.mini-image {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-sm);
    object-fit: cover;
    border: 2px solid var(--border-color);
    transition: var(--transition-fast);
}

.mini-image:hover {
    border-color: var(--primary-color);
    transform: scale(1.1);
}

.product-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-sm);
    background: var(--gradient-soft);
    border-radius: var(--radius-md);
    margin-bottom: var(--spacing-sm);
}

.product-price {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary-color);
}

.product-stock {
    text-align: right;
}

.stock-label {
    font-size: 0.7rem;
    color: var(--text-secondary);
}

.stock-value {
    font-size: 1rem;
    font-weight: 600;
}

.stock-value.in-stock {
    color: var(--success);
}

.stock-value.out-of-stock {
    color: var(--error);
}

.product-actions {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: var(--spacing-xs);
}

.btn-product {
    padding: 8px 4px;
    border: none;
    border-radius: var(--radius-sm);
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.75rem;
}

.btn-view {
    background: var(--gradient-primary);
    color: white;
}

.btn-edit {
    background: white;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
}

.btn-delete {
    background: white;
    color: var(--error);
    border: 2px solid var(--error);
}

.btn-product:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-light);
}

/* ==================== √âTAT VIDE ==================== */
.empty-state {
    text-align: center;
    padding: var(--spacing-xl) var(--spacing-lg);
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-light);
    grid-column: 1 / -1;
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: var(--spacing-md);
}

.empty-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.empty-text {
    color: var(--text-secondary);
    margin-bottom: var(--spacing-lg);
}

.btn-add-product {
    padding: var(--spacing-md) var(--spacing-xl);
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
}

.btn-add-product:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-heavy);
}

/* ==================== MODAL ==================== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-md);
    backdrop-filter: blur(5px);
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    max-width: 900px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    animation: fadeIn 0.3s ease;
}

.modal-header {
    padding: var(--spacing-lg);
    border-bottom: 2px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    background: var(--bg-card);
    z-index: 10;
}

.modal-close {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 59, 48, 0.1);
    color: var(--error);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition-fast);
}

.modal-close:hover {
    background: var(--error);
    color: white;
}

.modal-body {
    padding: var(--spacing-lg);
}

.modal-images {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.modal-main-image {
    grid-column: 1 / -1;
    width: 100%;
    height: 400px;
    object-fit: cover;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-medium);
}

.modal-desc-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: var(--radius-md);
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .sidebar-left {
        display: none;
    }
    
    .products-container {
        margin-left: 0;
    }

    .hamburger-btn {
        display: flex;
    }

    .brand-name {
        font-size: 1.1rem;
    }

    .user-name {
        display: none;
    }

    .products-container {
        padding: calc(70px + var(--spacing-md)) var(--spacing-md) var(--spacing-md);
    }

    .page-title {
        font-size: 1.8rem;
    }

    .filters-section {
        padding: var(--spacing-md);
    }

    .search-bar {
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .search-input,
    .filter-select {
        min-width: 100%;
        width: 100%;
        padding: var(--spacing-sm);
        font-size: 0.9rem;
    }

    .stats-row {
        flex-direction: column;
        gap: var(--spacing-sm);
        align-items: stretch;
    }

    .products-count {
        font-size: 0.9rem;
    }

    .action-buttons {
        flex-direction: column;
        gap: var(--spacing-xs);
    }

    .btn-action {
        width: 100%;
        padding: var(--spacing-sm);
        font-size: 0.85rem;
    }

    .products-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }

    .product-image-container {
        height: 160px;
    }

    .product-content {
        padding: var(--spacing-sm);
    }

    .product-title {
        font-size: 1rem;
    }

    .product-description {
        font-size: 0.8rem;
    }

    .product-price {
        font-size: 1.1rem;
    }

    .product-actions {
        grid-template-columns: 1fr;
        gap: 6px;
    }

    .btn-product {
        padding: 10px 8px;
        font-size: 0.8rem;
    }

    .mini-image {
        width: 35px;
        height: 35px;
    }

    .modal-images {
        grid-template-columns: 1fr;
    }

    .modal-main-image {
        height: 250px;
    }

    .modal-header,
    .modal-body {
        padding: var(--spacing-md);
    }
}
</style>
<body>
     <!-- Menu Hamburger Overlay -->
     <div class="hamburger-overlay" id="hamburgerOverlay"></div>
    
     <!-- Menu Hamburger -->
     <div class="hamburger-menu" id="hamburgerMenu">
         <div class="hamburger-header">
             <div class="brand-section">
                 <div class="logo-image"></div>
                 <h1 class="brand-name">ODA</h1>
             </div>
             <button class="close-menu" id="closeMenu">
                 <span>√ó</span>
             </button>
         </div>
         
         <nav class="hamburger-nav">
             <a href="tableau.html" class="hamburger-link">
                 <span class="link-icon">üìä</span>
                 <span>Tableau de bord</span>
             </a>
             <a href="produit.html" class="hamburger-link active">
                 <span class="link-icon">üì¶</span>
                 <span>Produits</span>
             </a>
             <a href="commandes.html" class="hamburger-link">
                 <span class="link-icon">üìã</span>
                 <span>Commandes</span>
             </a>
             <a href="clients.html" class="hamburger-link">
                 <span class="link-icon">üë•</span>
                 <span>Clients</span>
             </a>
             <a href="messages.html" class="hamburger-link">
                 <span class="link-icon">üí¨</span>
                 <span>Messages</span>
             </a>
             
             <div class="hamburger-divider"></div>
             
             <a href="statitique.html" class="hamburger-link">
                 <span class="link-icon">üìä</span>
                 <span>Statistiques</span>
             </a>
             <a href="parametre.html" class="hamburger-link">
                 <span class="link-icon">‚öôÔ∏è</span>
                 <span>Param√®tres</span>
             </a>
             <a href="e-commerce2.html" class="hamburger-link">
                 <span class="link-icon">üè™</span>
                 <span>Voir ma boutique</span>
             </a>
         </nav>
         
         <a href="https://whatsapp.com/channel/0029Vb6mcUm5q08htMMdVA2v" class="hamburger-link">
            <span class="link-icon">‚úÜ</span>
            <span>Rejoindre notre chaine</span>
        </a>
        <a href="https://t.me/+hqymnTrseaU2OWRk" class="hamburger-link">
            <span class="link-icon">üó©</span>
            <span>rejoindre notre groupe telegram</span>
        </a>
     </div>

    <!-- Header Principal -->
    <header class="main-header">
        <div class="header-container">
            <button class="hamburger-btn" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <div class="brand-section">
                <div class="logo-image">ÔøΩÔ∏è</div>
                <h1 class="brand-name">Ma Boutique √âl√©gante</h1>
            </div>

            <div class="header-actions">
                <button class="icon-btn notification-btn">
                    <span>üîî</span>
                    <span class="badge">3</span>
                </button>
                <div class="user-profile">
                    <div class="avatar-image"></div>
                    <span class="user-name">Admin</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Conteneur Principal -->
    <div class="products-container">
        <!-- En-t√™te de page -->
        <div class="page-header">
            <h1 class="page-title">Mes Produits</h1>
            <p class="page-subtitle">G√©rez tous vos produits en un seul endroit</p>
        </div>

        <!-- Section Filtres -->
        <div class="filters-section">
            <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="üîç Rechercher un produit...">
                
                <select id="categoryFilter" class="filter-select">
                    <option value="">S√©lectionnez une cat√©gorie</option>
                            <option value="Vetements">Vetements</option>
                            <option value="Electroniques">Electroniques</option>
                            <option value="Decoration">Decoration</option>
                            <option value="Accessoires">Accessoires</option>
                            <option value="Electromenager">Electromenager</option>
                            <option value="Beaute & soin">Beaute & soin</option>
                            <option value="Accessoires">Accessoires</option>
                            <option value="Bebe">Bebe</option>
                            <option value="jeux & jouets">jeux & jouets</option>
                            <option value="Bricolage">Bricolage</option>
                            <option value="Alimentation">Alimentation</option>
                            <option value="Boissons">Boissons</option>
                            <option value="Livre">Livre</option>
                            <option value="Hygiene & sante">Hygiene & sante</option>
                            <option value="fitness">fitness</option>
                            <option value="Animaux">Animaux</option>
                            <option value="Luxe">Luxe</option>
                            <option value="Bureau">Bureau</option>
                </select>

                <select id="statusFilter" class="filter-select">
                    <option value="">Tous statuts</option>
                    <option value="published">Publi√©</option>
                    <option value="draft">Brouillon</option>
                </select>

                <select id="sortFilter" class="filter-select">
                    <option value="recent">Plus r√©cents</option>
                    <option value="name">Nom A-Z</option>
                    <option value="price-asc">Prix croissant</option>
                    <option value="price-desc">Prix d√©croissant</option>
                    <option value="stock">Stock</option>
                </select>
            </div>

            <div class="stats-row">
                <div class="products-count" id="productsCount">0 produit(s) trouv√©(s)</div>
                <div class="action-buttons">
                    <button class="btn-action" onclick="exportToJSON()">üì• Exporter</button>
                    <button class="btn-action" onclick="window.location.href='tableau.html'">+ Ajouter</button>
                </div>
            </div>
        </div>

        <!-- Grille de produits -->
        <div class="products-grid" id="productsGrid">
            <!-- Les produits seront inject√©s ici par JavaScript -->
        </div>
    </div>

    <!-- Modal D√©tails Produit -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">D√©tails du produit</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Le contenu sera inject√© par JavaScript -->
            </div>
        </div>
    </div>

    <script type="module">
        // ==================== CONFIGURATION SUPABASE ====================
        const SUPABASE_URL = 'https://xjckbqbqxcwzcrlmuvzf.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqY2ticWJxeGN3emNybG11dnpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MTk1MzMsImV4cCI6MjA3NjA5NTUzM30.AMzAUwtjFt7Rvof5r2enMyYIYToc1wNWWEjvZqK_YXM';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Variables globales
let produits = [];
let filteredProduits = [];
let currentUser = null;

// ==================== INITIALISATION ====================
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üå∏ Page Produits initialis√©e !');
    
    await verifierAuthentification();
    initialiserMenuHamburger(); // ‚úÖ DOIT √äTRE L√Ä
    // ajouterBoutonDeconnexion(); // ‚ùå RETIR√â
    ajouterBoutonAbonnement();
    ajouterLienAbonnementMenu();
    await verifierAbonnement();
    await chargerProduits();
    initFilters();
    verifierEdition();
    
    console.log('‚úÖ Page produits pr√™te avec Supabase');
});
// Apr√®s la fonction voirDetails
window.voirDetails = voirDetails;

// Apr√®s la fonction modifierProduit
window.modifierProduit = modifierProduit;

// Apr√®s la fonction supprimerProduit
window.supprimerProduit = supprimerProduit;

// Apr√®s la fonction exportToJSON
window.exportToJSON = exportToJSON;

// Apr√®s la fonction closeModal
window.closeModal = closeModal;
// ==================== AUTHENTIFICATION ====================
async function verifierAuthentification() {
    try {
        const { data: { session }, error } = await supabase.auth.getSession();
        
        if (error) throw error;
        
        if (!session) {
            console.warn('‚ö†Ô∏è Aucune session active');
            window.location.href = 'index.html';
            return;
        }
        
        currentUser = session.user;
        console.log('‚úÖ Utilisateur connect√©:', currentUser.email);
        
        const userNameElement = document.querySelector('.user-name');
        if (userNameElement) {
            userNameElement.textContent = currentUser.email.split('@')[0];
        }
        
    } catch (error) {
        console.error('‚ùå Erreur authentification:', error);
        window.location.href = 'index.html';
    }
}

function ajouterBoutonDeconnexion() {
    const headerActions = document.querySelector('.header-actions');
    if (!headerActions) return;
    
    const logoutBtn = document.createElement('button');
    logoutBtn.textContent = 'üö™ D√©connexion';
    logoutBtn.style.cssText = `
        padding: 8px 16px;
        background: #FF3B30;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Poppins', sans-serif;
        font-weight: 500;
        transition: all 0.3s ease;
    `;
    
    logoutBtn.addEventListener('mouseover', () => {
        logoutBtn.style.background = '#CC2F26';
    });
    
    logoutBtn.addEventListener('mouseout', () => {
        logoutBtn.style.background = '#FF3B30';
    });
    
    logoutBtn.addEventListener('click', async () => {
        try {
            const confirmer = confirm('Voulez-vous vraiment vous d√©connecter ?');
            if (!confirmer) return;
            
            logoutBtn.disabled = true;
            logoutBtn.textContent = '‚è≥ D√©connexion...';
            
            const { error } = await supabase.auth.signOut();
            
            if (error) throw error;
            
            console.log('‚úÖ D√©connexion r√©ussie');
            afficherNotification('‚úÖ D√©connexion r√©ussie', 'success');
            
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 500);
            
        } catch (error) {
            console.error('‚ùå Erreur d√©connexion:', error);
            afficherNotification('‚ùå Erreur lors de la d√©connexion', 'error');
            logoutBtn.disabled = false;
            logoutBtn.textContent = 'üö™ D√©connexion';
        }
    });
    
    headerActions.appendChild(logoutBtn);
}



// ==================== MENU HAMBURGER - OPTIMIS√â PC + ANDROID ====================
function initialiserMenuHamburger() {
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const hamburgerOverlay = document.getElementById('hamburgerOverlay');
    const closeMenu = document.getElementById('closeMenu');
    
    console.log('üîç Initialisation menu hamburger...', {
        bouton: !!hamburgerBtn,
        menu: !!hamburgerMenu,
        overlay: !!hamburgerOverlay
    });
    
    if (!hamburgerBtn || !hamburgerMenu || !hamburgerOverlay) {
        console.error('‚ùå √âl√©ments du menu manquants');
        return;
    }
    
    // Fonction pour ouvrir le menu
    const ouvrirMenu = (e) => {
        if (e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        console.log('üìÇ Ouverture du menu');
        
        hamburgerBtn.classList.add('active');
        hamburgerMenu.classList.add('active');
        hamburgerOverlay.classList.add('active');
        document.body.classList.add('menu-open');
        
        // Bloquer le scroll
        const scrollY = window.scrollY;
        document.body.style.position = 'fixed';
        document.body.style.top = `-${scrollY}px`;
        document.body.style.width = '100%';
    };
    
    // Fonction pour fermer le menu
    const fermerMenu = (e) => {
        if (e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        console.log('üîí Fermeture du menu');
        
        hamburgerBtn.classList.remove('active');
        hamburgerMenu.classList.remove('active');
        hamburgerOverlay.classList.remove('active');
        document.body.classList.remove('menu-open');
        
        // Restaurer le scroll
        const scrollY = document.body.style.top;
        document.body.style.position = '';
        document.body.style.top = '';
        document.body.style.width = '';
        window.scrollTo(0, parseInt(scrollY || '0') * -1);
    };
    
    // Toggle du menu
    const toggleMenu = (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        if (hamburgerMenu.classList.contains('active')) {
            fermerMenu(e);
        } else {
            ouvrirMenu(e);
        }
    };
    
    // Event listeners pour le bouton hamburger (PC + Mobile)
    hamburgerBtn.addEventListener('touchstart', toggleMenu, { passive: false });
    hamburgerBtn.addEventListener('click', toggleMenu);
    
    // Event listener pour le bouton de fermeture
    if (closeMenu) {
        closeMenu.addEventListener('touchstart', fermerMenu, { passive: false });
        closeMenu.addEventListener('click', fermerMenu);
    }
    
    // Event listener pour l'overlay
    hamburgerOverlay.addEventListener('touchstart', fermerMenu, { passive: false });
    hamburgerOverlay.addEventListener('click', fermerMenu);
    
    // Event listeners pour les liens du menu
    const hamburgerLinks = document.querySelectorAll('.hamburger-link');
    hamburgerLinks.forEach(link => {
        link.addEventListener('click', () => {
            setTimeout(() => fermerMenu(), 200);
        });
    });
    
    // Fermer avec la touche Escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && hamburgerMenu.classList.contains('active')) {
            fermerMenu();
        }
    });
    
    console.log('‚úÖ Menu hamburger initialis√© avec succ√®s (PC + Android)');
}


// ==================== MISE √Ä JOUR STATS SIDEBAR ====================
function mettreAJourStatsSidebar() {
    const totalProducts = produits.length;
    const publishedProducts = produits.filter(p => p.statut === 'published').length;
    const draftProducts = produits.filter(p => p.statut === 'draft').length;
    
    const totalEl = document.getElementById('totalProducts');
    const publishedEl = document.getElementById('publishedProducts');
    const draftEl = document.getElementById('draftProducts');
    
    if (totalEl) totalEl.textContent = totalProducts;
    if (publishedEl) publishedEl.textContent = publishedProducts;
    if (draftEl) draftEl.textContent = draftProducts;
}

// ==================== CHARGEMENT DES PRODUITS ====================
async function chargerProduits() {
    try {
        console.log('üì¶ Chargement des produits depuis Supabase...');
        
        if (!currentUser) {
            console.warn('‚ö†Ô∏è Aucun utilisateur connect√©');
            return [];
        }
        
        const { data, error } = await supabase
            .from('produits')
            .select('*')
            .eq('user_id', currentUser.id)
            .order('created_at', { ascending: false });

        if (error) throw error;

        // Convertir les donn√©es Supabase
        produits = (data || []).map(p => ({
            id: p.id,
            nom: p.nom,
            description: p.description,
            prix: p.prix,
            stock: p.stock,
            categorie: p.categorie,
            statut: p.statut,
            mainImage: p.main_image,
            descriptionImages: p.description_images || [],
            dateCreation: p.created_at
        }));

        filteredProduits = [...produits];
        
        // Sauvegarder dans localStorage pour sync avec autres pages
        sauvegarderDansLocalStorage();
        
        afficherProduits();
        console.log(`‚úÖ ${produits.length} produit(s) charg√©(s) depuis Supabase`);
        
        return produits;
    } catch (error) {
        console.error('‚ùå Erreur lors du chargement des produits:', error);
        afficherNotification('‚ùå Erreur lors du chargement des produits', 'error');
        return [];
    }
}

function sauvegarderDansLocalStorage() {
    try {
        localStorage.setItem('produits_ecommerce', JSON.stringify(produits));
        console.log('üíæ Produits sauvegard√©s dans localStorage');
        console.log(`üì¶ ${produits.length} produit(s) synchronis√©(s)`);
    } catch (error) {
        console.error('‚ùå Erreur sauvegarde localStorage:', error);
    }
}

// ==================== AFFICHAGE DES PRODUITS ====================
function afficherProduits() {
    const grid = document.getElementById('productsGrid');
    const countEl = document.getElementById('productsCount');

    if (!grid) return;

    grid.innerHTML = '';

    if (filteredProduits.length === 0) {
        grid.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üõçÔ∏è</div>
                <h3 class="empty-title">Aucun produit trouv√©</h3>
                <p class="empty-text">Commencez par ajouter votre premier produit</p>
                <button class="btn-add-product" onclick="window.location.href='tableau.html'">
                    + Ajouter un produit
                </button>
            </div>
        `;
        if (countEl) countEl.textContent = '0 produit trouv√©';
        mettreAJourStatsSidebar();
        return;
    }

    if (countEl) countEl.textContent = `${filteredProduits.length} produit(s) trouv√©(s)`;

    filteredProduits.forEach((produit, index) => {
        const card = creerCarteProduit(produit, index);
        grid.appendChild(card);
    });
    
    // Mettre √† jour les stats sidebar
    mettreAJourStatsSidebar();
}

function creerCarteProduit(produit, index) {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.style.animationDelay = `${index * 0.1}s`;

    const statusBadge = produit.statut === 'published' 
        ? '<span class="badge badge-published">‚úì Publi√©</span>'
        : '<span class="badge badge-draft">üìù Brouillon</span>';

    const descImagesHtml = produit.descriptionImages && produit.descriptionImages.filter(img => img).length > 0
        ? `<div class="product-images-preview">
            ${produit.descriptionImages.filter(img => img).slice(0, 4).map(img => 
                `<img src="${img}" class="mini-image" alt="Description">`
            ).join('')}
           </div>`
        : '';

    card.innerHTML = `
        <div class="product-image-container">
            <img src="${produit.mainImage || 'https://via.placeholder.com/300x250'}" 
                 class="product-image" 
                 alt="${produit.nom}"
                 onerror="this.src='https://via.placeholder.com/300x250?text=Image+non+disponible'">
            <div class="product-badges">
                ${statusBadge}
                <span class="badge badge-category">${produit.categorie}</span>
            </div>
        </div>
        
        <div class="product-content">
            <h3 class="product-title">${produit.nom}</h3>
            <p class="product-description">${produit.description}</p>
            
            ${descImagesHtml}
            
            <div class="product-info">
                <div class="product-price">${produit.prix.toLocaleString('fr-FR')} FCFA</div>
                <div class="product-stock">
                    <div class="stock-label">Stock</div>
                    <div class="stock-value ${produit.stock > 0 ? 'in-stock' : 'out-of-stock'}">
                        ${produit.stock}
                    </div>
                </div>
            </div>
            
            <div class="product-actions">
                <button class="btn-product btn-view" onclick="voirDetails(${produit.id})">
                    üëÅÔ∏è Voir
                </button>
                <button class="btn-product btn-edit" onclick="modifierProduit(${produit.id})">
                    ‚úèÔ∏è Modifier
                </button>
                <button class="btn-product btn-delete" onclick="supprimerProduit(${produit.id})">
                    üóëÔ∏è Supprimer
                </button>
            </div>
        </div>
    `;

    return card;
}
let abonnementActuel = null;

/**
 * V√©rifier l'abonnement de l'utilisateur au chargement
 */
async function verifierAbonnement() {
    try {
        if (!currentUser) return;

        const { data, error } = await supabase
            .from('abonnements')
            .select('*')
            .eq('user_id', currentUser.id)
            .single();

        if (error && error.code !== 'PGRST116') {
            console.error('Erreur v√©rification abonnement:', error);
            return;
        }

        if (data) {
            abonnementActuel = data;
            const expiration = new Date(data.date_expiration);
            const maintenant = new Date();

            if (expiration <= maintenant) {
                // Abonnement expir√©
                await gererAbonnementExpire();
                afficherBanniereAbonnement('expired');
            } else {
                // Abonnement actif - V√©rifier la limite
                await verifierLimiteProduits(data.limite_produits);
                afficherBanniereAbonnement('active', data);
            }
        } else {
            // Pas d'abonnement
            afficherBanniereAbonnement('none');
        }
    } catch (error) {
        console.error('‚ùå Erreur v√©rification abonnement:', error);
    }
}

/**
 * G√©rer l'expiration de l'abonnement
 */
async function gererAbonnementExpire() {
    try {
        // Mettre tous les produits en brouillon
        const { error } = await supabase
            .from('produits')
            .update({ statut: 'draft' })
            .eq('user_id', currentUser.id)
            .eq('statut', 'published');

        if (error) throw error;

        // Mettre √† jour l'abonnement
        await supabase
            .from('abonnements')
            .update({ statut: 'expire' })
            .eq('user_id', currentUser.id);

        console.log('‚ö†Ô∏è Abonnement expir√© - Produits mis en brouillon');
        
        // Recharger les produits
        await chargerProduits();
        
    } catch (error) {
        console.error('‚ùå Erreur gestion expiration:', error);
    }
}

/**
 * V√©rifier si l'utilisateur d√©passe sa limite de produits
 */
async function verifierLimiteProduits(limite) {
    try {
        const { data, error } = await supabase
            .from('produits')
            .select('id, statut')
            .eq('user_id', currentUser.id)
            .eq('statut', 'published');

        if (error) throw error;

        const nombrePublies = data ? data.length : 0;

        if (nombrePublies > limite) {
            // D√©passe la limite - Mettre les plus anciens en brouillon
            await mettreExcedentEnBrouillon(nombrePublies - limite);
        }
    } catch (error) {
        console.error('‚ùå Erreur v√©rification limite:', error);
    }
}

/**
 * Mettre les produits exc√©dentaires en brouillon
 */
async function mettreExcedentEnBrouillon(nombre) {
    try {
        // R√©cup√©rer les produits les plus anciens
        const { data, error } = await supabase
            .from('produits')
            .select('id')
            .eq('user_id', currentUser.id)
            .eq('statut', 'published')
            .order('created_at', { ascending: true })
            .limit(nombre);

        if (error) throw error;

        if (data && data.length > 0) {
            const ids = data.map(p => p.id);
            
            const { error: updateError } = await supabase
                .from('produits')
                .update({ statut: 'draft' })
                .in('id', ids);

            if (updateError) throw updateError;

            afficherNotification(
                `‚ö†Ô∏è ${nombre} produit(s) mis en brouillon car vous avez d√©pass√© votre limite`,
                'warning'
            );
            
            await chargerProduits();
        }
    } catch (error) {
        console.error('‚ùå Erreur mise en brouillon:', error);
    }
}

/**
 * Afficher une banni√®re d'information sur l'abonnement
 */
function afficherBanniereAbonnement(statut, data = null) {
    // Supprimer l'ancienne banni√®re si elle existe
    const ancienneBanniere = document.getElementById('subscription-banner');
    if (ancienneBanniere) {
        ancienneBanniere.remove();
    }

    const banniere = document.createElement('div');
    banniere.id = 'subscription-banner';
    banniere.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: white;
        padding: 20px 24px;
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        z-index: 1500;
        max-width: 400px;
        animation: slideInRight 0.5s ease;
        font-family: 'Poppins', sans-serif;
    `;

    let contenu = '';
    
    switch(statut) {
        case 'none':
            banniere.style.borderLeft = '4px solid #FF9500';
            contenu = `
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="font-size: 2rem;">‚ö†Ô∏è</div>
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600;">
                            Aucun abonnement actif
                        </h3>
                        <p style="margin: 0 0 16px 0; color: #666; font-size: 0.9rem;">
                            Souscrivez √† un abonnement pour publier vos produits
                        </p>
                        <button onclick="window.location.href='abonnement.html'" 
                                style="width: 100%; padding: 12px; background: linear-gradient(135deg, #007AFF 0%, #5AC8FA 100%); 
                                       color: white; border: none; border-radius: 12px; font-weight: 600; 
                                       cursor: pointer; font-family: 'Poppins', sans-serif;">
                            üìã Voir les offres
                        </button>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; font-size: 1.5rem; 
                                   cursor: pointer; color: #999; padding: 0; line-height: 1;">
                        √ó
                    </button>
                </div>
            `;
            break;

        case 'expired':
            banniere.style.borderLeft = '4px solid #FF3B30';
            contenu = `
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="font-size: 2rem;">üö´</div>
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600; color: #FF3B30;">
                            Abonnement expir√©
                        </h3>
                        <p style="margin: 0 0 16px 0; color: #666; font-size: 0.9rem;">
                            Vos produits sont en brouillon. Renouvelez pour les r√©activer
                        </p>
                        <button onclick="window.location.href='abonnement.html'" 
                                style="width: 100%; padding: 12px; background: #FF3B30; 
                                       color: white; border: none; border-radius: 12px; font-weight: 600; 
                                       cursor: pointer; font-family: 'Poppins', sans-serif;">
                            üîÑ Renouveler maintenant
                        </button>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; font-size: 1.5rem; 
                                   cursor: pointer; color: #999; padding: 0; line-height: 1;">
                        √ó
                    </button>
                </div>
            `;
            break;

        case 'active':
            const expiration = new Date(data.date_expiration);
            const maintenant = new Date();
            const joursRestants = Math.ceil((expiration - maintenant) / (1000 * 60 * 60 * 24));
            const pourcentage = (produits.filter(p => p.statut === 'published').length / data.limite_produits) * 100;
            
            banniere.style.borderLeft = '4px solid #34C759';
            contenu = `
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="font-size: 2rem;">‚úÖ</div>
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600; color: #34C759;">
                            Plan ${data.plan.toUpperCase()} actif
                        </h3>
                        <p style="margin: 0 0 12px 0; color: #666; font-size: 0.85rem;">
                            ${produits.filter(p => p.statut === 'published').length}/${data.limite_produits} produits utilis√©s
                        </p>
                        <div style="background: #f0f0f0; height: 8px; border-radius: 4px; margin-bottom: 12px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #34C759, #4CAF50); height: 100%; width: ${pourcentage}%; transition: width 0.3s ease;"></div>
                        </div>
                        <p style="margin: 0; color: #999; font-size: 0.8rem;">
                            Expire dans ${joursRestants} jour${joursRestants > 1 ? 's' : ''}
                        </p>
                        ${joursRestants <= 7 ? `
                            <button onclick="window.location.href='abonnement.html'" 
                                    style="width: 100%; padding: 10px; margin-top: 12px; background: #FF9500; 
                                           color: white; border: none; border-radius: 10px; font-weight: 600; 
                                           cursor: pointer; font-family: 'Poppins', sans-serif; font-size: 0.85rem;">
                                ‚è∞ Renouveler maintenant
                            </button>
                        ` : ''}
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; font-size: 1.5rem; 
                                   cursor: pointer; color: #999; padding: 0; line-height: 1;">
                        √ó
                    </button>
                </div>
            `;
            break;
    }

    banniere.innerHTML = contenu;
    document.body.appendChild(banniere);
}

/**
 * Ajouter un bouton "Abonnements" dans le header
 */
function ajouterBoutonAbonnement() {
    const headerActions = document.querySelector('.header-actions');
    if (!headerActions) return;

    // V√©rifier si le bouton existe d√©j√†
    if (document.getElementById('btn-abonnement')) return;

    const btnAbonnement = document.createElement('a');
    btnAbonnement.id = 'btn-abonnement';
    btnAbonnement.href = 'abonnement.html';
    btnAbonnement.style.cssText = `
        padding: 10px 20px;
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-family: 'Poppins', sans-serif;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
    `;
    btnAbonnement.innerHTML = 'üëë Abonnements';

    btnAbonnement.addEventListener('mouseover', () => {
        btnAbonnement.style.transform = 'translateY(-2px)';
        btnAbonnement.style.boxShadow = '0 6px 16px rgba(255, 165, 0, 0.4)';
    });

    btnAbonnement.addEventListener('mouseout', () => {
        btnAbonnement.style.transform = 'translateY(0)';
        btnAbonnement.style.boxShadow = '0 4px 12px rgba(255, 165, 0, 0.3)';
    });

    // Ins√©rer avant le bouton de d√©connexion
    const logoutBtn = Array.from(headerActions.children).find(
        child => child.textContent.includes('D√©connexion')
    );
    
    if (logoutBtn) {
        headerActions.insertBefore(btnAbonnement, logoutBtn);
    } else {
        headerActions.appendChild(btnAbonnement);
    }
}

/**
 * Ajouter le lien dans le menu hamburger
 */
function ajouterLienAbonnementMenu() {
    const hamburgerNav = document.querySelector('.hamburger-nav');
    if (!hamburgerNav) return;

    // V√©rifier si le lien existe d√©j√†
    if (document.getElementById('menu-abonnement')) return;

    const lienAbonnement = document.createElement('a');
    lienAbonnement.id = 'menu-abonnement';
    lienAbonnement.href = 'abonnement.html';
    lienAbonnement.className = 'hamburger-link';
    lienAbonnement.innerHTML = `
        <span class="link-icon">üëë</span>
        <span>Abonnements</span>
    `;

    // Ins√©rer apr√®s le lien "Param√®tres"
    const parametresLink = Array.from(hamburgerNav.querySelectorAll('.hamburger-link'))
        .find(link => link.textContent.includes('Param√®tres'));
    
    if (parametresLink) {
        parametresLink.after(lienAbonnement);
    } else {
        hamburgerNav.appendChild(lienAbonnement);
    }
}

// ==================== ANIMATION CSS ====================
const styleAbonnement = document.createElement('style');
styleAbonnement.textContent = `
    @keyframes slideInRight {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    #subscription-banner {
        animation: slideInRight 0.5s ease;
    }
`;
document.head.appendChild(styleAbonnement);


// ==================== FILTRES ====================
function initFilters() {
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const statusFilter = document.getElementById('statusFilter');
    const sortFilter = document.getElementById('sortFilter');

    searchInput?.addEventListener('input', appliquerFiltres);
    categoryFilter?.addEventListener('change', appliquerFiltres);
    statusFilter?.addEventListener('change', appliquerFiltres);
    sortFilter?.addEventListener('change', appliquerFiltres);
}

function appliquerFiltres() {
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const statusFilter = document.getElementById('statusFilter');
    const sortFilter = document.getElementById('sortFilter');

    const searchTerm = searchInput?.value.toLowerCase() || '';
    const category = categoryFilter?.value || '';
    const status = statusFilter?.value || '';
    const sort = sortFilter?.value || 'recent';

    // Filtrer
    filteredProduits = produits.filter(produit => {
        const matchSearch = produit.nom.toLowerCase().includes(searchTerm) || 
                           produit.description.toLowerCase().includes(searchTerm);
        const matchCategory = !category || produit.categorie === category;
        const matchStatus = !status || produit.statut === status;
        
        return matchSearch && matchCategory && matchStatus;
    });

    // Trier
    switch(sort) {
        case 'name':
            filteredProduits.sort((a, b) => a.nom.localeCompare(b.nom));
            break;
        case 'price-asc':
            filteredProduits.sort((a, b) => a.prix - b.prix);
            break;
        case 'price-desc':
            filteredProduits.sort((a, b) => b.prix - a.prix);
            break;
        case 'stock':
            filteredProduits.sort((a, b) => b.stock - a.stock);
            break;
        case 'recent':
        default:
            filteredProduits.sort((a, b) => new Date(b.dateCreation) - new Date(a.dateCreation));
            break;
    }

    afficherProduits();
}
// ==================== MODAL D√âTAILS ====================
function voirDetails(idProduit) {
    const produit = produits.find(p => p.id === idProduit);
    if (!produit) return;

    const modal = document.getElementById('productModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    if (!modal || !modalTitle || !modalBody) return;

    modalTitle.textContent = produit.nom;

    const descImagesHtml = produit.descriptionImages && produit.descriptionImages.filter(img => img).length > 0
        ? produit.descriptionImages.filter(img => img).map(img => 
            `<img src="${img}" class="modal-desc-image" alt="Description" onerror="this.style.display='none'">`
          ).join('')
        : '';

    modalBody.innerHTML = `
        <div class="modal-images">
            <img src="${produit.mainImage}" class="modal-main-image" alt="${produit.nom}"
                 onerror="this.src='https://via.placeholder.com/600x400?text=Image+non+disponible'">
            ${descImagesHtml}
        </div>

        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 1.3rem; font-weight: 600; color: var(--primary-color); margin-bottom: 12px;">
                Description
            </h3>
            <p style="color: var(--text-secondary); line-height: 1.8;">
                ${produit.description}
            </p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 24px;">
            <div style="padding: 16px; background: var(--gradient-soft); border-radius: 12px;">
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px;">Prix</p>
                <p style="font-size: 1.3rem; font-weight: 700; color: var(--primary-color);">
                    ${produit.prix.toLocaleString('fr-FR')} FCFA
                </p>
            </div>

            <div style="padding: 16px; background: var(--gradient-soft); border-radius: 12px;">
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px;">Stock</p>
                <p style="font-size: 1.3rem; font-weight: 700; color: ${produit.stock > 0 ? '#4CAF50' : '#f44336'};">
                    ${produit.stock}
                </p>
            </div>

            <div style="padding: 16px; background: var(--gradient-soft); border-radius: 12px;">
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px;">Cat√©gorie</p>
                <p style="font-size: 1rem; font-weight: 600; color: var(--text-primary);">
                    ${produit.categorie}
                </p>
            </div>

            <div style="padding: 16px; background: var(--gradient-soft); border-radius: 12px;">
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px;">Statut</p>
                <p style="font-size: 1rem; font-weight: 600; color: ${produit.statut === 'published' ? '#4CAF50' : '#FF9800'};">
                    ${produit.statut === 'published' ? '‚úì Publi√©' : 'üìù Brouillon'}
                </p>
            </div>
        </div>

        <div style="padding: 16px; background: rgba(199, 125, 255, 0.05); border-radius: 12px; border-left: 4px solid var(--primary-color);">
            <p style="font-size: 0.85rem; color: var(--text-secondary);">
                <strong>Cr√©√© le:</strong> ${new Date(produit.dateCreation).toLocaleDateString('fr-FR', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })}
            </p>
        </div>
    `;

    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    const modal = document.getElementById('productModal');
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }
}

// Fermer modal en cliquant en dehors
document.getElementById('productModal')?.addEventListener('click', (e) => {
    if (e.target.id === 'productModal') {
        closeModal();
    }
});

// ==================== MODIFICATION DE PRODUIT ====================
function modifierProduit(idProduit) {
    localStorage.setItem('produit_en_edition', idProduit);
    window.location.href = 'tableau.html';
}

async function verifierEdition() {
    const idProduit = localStorage.getItem('produit_en_edition');
    
    if (idProduit && window.location.pathname.includes('tableau.html')) {
        await chargerProduitPourEdition(parseInt(idProduit));
        localStorage.removeItem('produit_en_edition');
    }
}

async function chargerProduitPourEdition(id) {
    try {
        if (!currentUser) return;
        
        const { data, error } = await supabase
            .from('produits')
            .select('*')
            .eq('id', id)
            .eq('user_id', currentUser.id)
            .single();

        if (error) throw error;

        if (typeof window.chargerProduitDansFormulaire === 'function') {
            window.chargerProduitDansFormulaire(data);
        }
    } catch (error) {
        console.error('‚ùå Erreur chargement produit:', error);
        afficherNotification('‚ùå Erreur lors du chargement du produit', 'error');
    }
}

// ==================== SUPPRESSION DE PRODUIT ====================
async function supprimerProduit(idProduit) {
    const produit = produits.find(p => p.id === idProduit);
    if (!produit) return;

    if (confirm(`‚ö†Ô∏è √ätes-vous s√ªr de vouloir supprimer "${produit.nom}" ?\n\nCette action est irr√©versible.`)) {
        try {
            const { error } = await supabase
                .from('produits')
                .delete()
                .eq('id', idProduit)
                .eq('user_id', currentUser.id);

            if (error) throw error;

            const index = produits.findIndex(p => p.id === idProduit);
            if (index !== -1) {
                produits.splice(index, 1);
            }

            // Mettre √† jour localStorage apr√®s suppression
            sauvegarderDansLocalStorage();

            appliquerFiltres();
            afficherNotification('‚úÖ Produit supprim√© avec succ√®s', 'success');
        } catch (error) {
            console.error('‚ùå Erreur lors de la suppression:', error);
            afficherNotification('‚ùå Erreur lors de la suppression du produit', 'error');
        }
    }
}

// ==================== EXPORT ====================
async function exportToJSON() {
    if (produits.length === 0) {
        afficherNotification('‚ö†Ô∏è Aucun produit √† exporter', 'warning');
        return;
    }

    const dataStr = JSON.stringify(produits, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const lien = document.createElement('a');
    lien.href = url;
    lien.download = `produits_${new Date().toISOString().split('T')[0]}.json`;
    lien.click();
    
    URL.revokeObjectURL(url);
    afficherNotification('üì• Produits export√©s avec succ√®s', 'success');
}

// ==================== NOTIFICATIONS ====================
function afficherNotification(message, type = 'info') {
    let conteneur = document.getElementById('notification-container');

    if (!conteneur) {
        conteneur = document.createElement('div');
        conteneur.id = 'notification-container';
        conteneur.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        `;
        document.body.appendChild(conteneur);
    }

    const couleurs = {
        success: '#4CAF50',
        error: '#f44336',
        info: '#C77DFF',
        warning: '#FF9800'
    };

    const notification = document.createElement('div');
    notification.style.cssText = `
        background: white;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(199, 125, 255, 0.2);
        border-left: 4px solid ${couleurs[type]};
        animation: slideIn 0.5s ease;
        max-width: 350px;
        font-family: 'Poppins', sans-serif;
        font-weight: 500;
        color: #333;
    `;
    notification.textContent = message;

    conteneur.appendChild(notification);

    setTimeout(() => {
        notification.style.animation = 'fadeOut 0.5s ease';
        setTimeout(() => notification.remove(), 500);
    }, 3000);
}

// ==================== ANIMATIONS CSS ====================
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes fadeOut {
        to {
            opacity: 0;
            transform: translateY(-10px);
        }
    }
`;
document.head.appendChild(style);

// ==================== RACCOURCIS CLAVIER ====================
document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + K pour focus sur la recherche
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('searchInput')?.focus();
    }

    // Escape pour fermer la modal
    if (e.key === 'Escape') {
        closeModal();
        
        // Fermer aussi le menu hamburger si ouvert
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const hamburgerOverlay = document.getElementById('hamburgerOverlay');
        
        if (hamburgerMenu?.classList.contains('active')) {
            hamburgerBtn?.classList.remove('active');
            hamburgerMenu?.classList.remove('active');
            hamburgerOverlay?.classList.remove('active');
            document.body.style.overflow = '';
        }
    }
});

// ==================== LOG DE D√âMARRAGE ====================
console.log('%cüå∏ Page Produits - Ma Boutique √âl√©gante üå∏', 'color: #C77DFF; font-size: 20px; font-weight: bold;');
console.log('%c‚úÖ Connect√© √† Supabase + Sync localStorage', 'color: #4CAF50; font-weight: bold;');
console.log('%cüíæ Les produits sont automatiquement synchronis√©s', 'color: #2196F3; font-size: 12px;');
console.log('%cüì± Menu hamburger + Sidebar PC identiques √† tableau.html', 'color: #FF9800; font-size: 12px;');
    </script>
</body>
</html>